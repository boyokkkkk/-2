# 🎨 绘图系统使用手册

## 1\. 简介

这是一个基于 PySide6 框架和计算机图形学算法实现的简单绘图应用程序。它支持直线、多边形、圆形、椭圆、曲线等基本图元绘制，并提供了平移、旋转、缩放、裁剪、撤销/重做等编辑功能，以及多种直线和曲线的绘制算法选择。

## 2\. 界面布局

程序界面分为三个主要区域：

1.  **顶部工具栏 (文件/编辑)**：包含文件操作（打开、保存、清空）和历史记录操作（撤销、恢复）。
2.  **左侧工具栏 (绘图/编辑工具)**：包含所有可用的绘图工具和图形编辑工具。
3.  **右侧属性面板 (属性/算法)**：用于设置画笔粗细、颜色、直线/曲线绘制算法。
4.  **中心区域 (画布)**：实际的绘图区域。

## 3\. 基本操作

### 3.1 文件操作 (顶部工具栏)

| 功能 | 快捷键 | 描述 |
| :--- | :--- | :--- |
| **打开** | - | 打开一个图片文件作为背景。 |
| **保存** | - | 将当前画布保存为图片文件 (`.png`, `.jpg`, `.bmp`)。 |
| **清空** | - | 清空画布上的所有图元和背景图。 |
| **撤销** | `Ctrl+Z` | 撤销上一步操作。 |
| **恢复** | `Ctrl+Y` | 恢复被撤销的操作。 |
| **帮助** | - | 打开用户手册。 |

### 3.2 属性设置 (右侧面板)

| 设置项 | 描述 | 操作方式 |
| :--- | :--- | :--- |
| **画笔粗细** | 设置当前绘制图元的线条宽度 (1-50px)。 | 拖动滑块调整。 |
| **颜色** | 设置当前绘制图元的线条颜色。 | 点击 **“选择颜色”** 按钮，从颜色对话框中选取。 |
| **直线算法** | 选择直线绘制算法：**Bresenham** (默认)、**DDA**、**XiaolinWu** (反走样)、**MSAA** (多重采样)、**QtBuiltIn**。 | 从下拉框中选择。 |
| **曲线算法** | 选择曲线绘制算法：**BSpline** (B 样条曲线，默认)、**Bezier** (贝塞尔曲线)。 | 从下拉框中选择。 |

> **注意：** 更改颜色、粗细、算法会影响后续绘制的新图元。更改算法还会自动更新画布上**所有**相应类型的图元。

## 4\. 绘图工具 (左侧工具栏)

左侧工具栏的绘图工具支持以下图元：

| 工具名称 | 状态枚举 | 快捷键 | 绘制方式 |
| :--- | :--- | :--- | :--- |
| **直线** | `Line` | `L` | **鼠标左键**：点下 (起点) -\> 拖动 -\> 释放 (终点)。 |
| **三角形** | `Triangle` | - | **鼠标左键**：点下 (一角) -\> 拖动 -\> 释放 (对角)。程序自动完成矩形对角线和另一角点的连线，形成三角形。 |
| **矩形** | `Rectangle` | `R` | **鼠标左键**：点下 (一角) -\> 拖动 -\> 释放 (对角)。程序自动完成矩形的四个顶点。 |
| **圆形** | `Circle` | `C` | **鼠标左键**：点下 (圆心) -\> 拖动 -\> 释放 (半径确定)。 |
| **椭圆** | `Ellipse` | `O` | **鼠标左键**：点下 (长轴一端) -\> 拖动 -\> 释放 (长轴/短轴确定)。 |
| **多边形** | `Polygon` | `P` | **鼠标左键**：点击添加顶点。**鼠标右键**：完成多边形绘制。 |
| **曲线** | `Curve` | `N` | **鼠标左键**：点击添加控制点。**鼠标右键**：完成曲线绘制。 |

## 5\. 编辑工具 (左侧工具栏)

左侧工具栏的编辑工具用于操作画布上已有的图元。所有操作都需要先选择相应的工具，然后**点击**画布上的图元来选中它。

| 工具名称 | 状态枚举 | 快捷键 | 操作方式 |
| :--- | :--- | :--- | :--- |
| **平移** | `Translate` | `T` | 1. 选中工具，点击目标图元。2. **按住鼠标左键拖动**，图元将跟随鼠标平移。3. 释放鼠标完成操作。 |
| **旋转** | `Rotate` | - | 1. 选中工具，点击目标图元。2. **按住鼠标左键**，从图元中心点附近拖动，图元将绕其几何中心旋转。3. 释放鼠标完成操作。 |
| **放大** | `ZoomIn` | - | 1. 选中工具。2. **单击**目标图元，图元将等比例放大 10% (缩放因子 $s=1.1$)。 |
| **缩小** | `ZoomOut` | - | 1. 选中工具。2. **单击**目标图元，图元将等比例缩小 10% (缩放因子 $s=0.9$)。 |
| **裁剪** | `Clip` | `X` | 1. 选中工具。2. **鼠标左键**：点下 (矩形裁剪区一角) -\> 拖动 -\> 释放 (对角)。<br>系统将使用 **Cohen-Sutherland 算法** 对**所有**直线图元进行裁剪。 |
| **删除** | `Trash` | - | 1. 选中工具。2. **单击**目标图元，图元将被立即删除。 |

> **提示：**
>
>   * 在使用平移、旋转、放大、缩小、删除工具时，对于除圆形、椭圆之外的图形请点击图形边框，对于圆形、椭圆请点击图形中点！！
>   * 圆形和椭圆不支持旋转操作。

## 6\. 高级功能：算法选择

本系统内置了多种图形学算法，您可以在右侧的“绘制算法”区域进行选择：

### 6.1 直线算法

| 算法名称 | 描述 | 特点 |
| :--- | :--- | :--- |
| **Bresenham** | 经典的中点画线算法。 | 速度快，只使用整数运算，但可能有锯齿。 |
| **DDA** | 数字微分分析法。 | 速度较快，使用浮点运算，可能有积累误差。 |
| **XiaolinWu** | Wu 晓林抗锯齿算法。 | 生成带透明度的点，实现平滑的抗锯齿效果。 |
| **MSAA** | 多重采样抗锯齿算法。 | 使用简单的多点采样实现一定程度的抗锯齿效果。 |
| **QtBuiltIn** | 使用 Qt 框架自带的绘制 API。 | 最简单，依赖底层图形库实现。 |

### 6.2 曲线算法

| 算法名称 | 描述 |
| :--- | :--- |
| **BSpline** | B 样条曲线。控制点对曲线的影响是局部的，曲线不一定通过控制点。 |
| **Bezier** | 贝塞尔曲线。控制点对曲线的影响是全局的，曲线会通过始末控制点。 |

## 7\. 故障排除

  * **无法绘制多边形/曲线？**
      * 确保您使用鼠标**右键**来结束多边形/曲线的顶点/控制点输入。
  * **平移/旋转/缩放无效？**
      * 确保您已在左侧工具栏选中了相应的编辑工具。
      * 确保您已在画布上成功**点击**选中了一个图元 (图元应高亮显示)。
  * **裁剪无效？**
      * 裁剪工具 (`Clip`) 目前仅对**直线**图元有效。
  * **代码警告：图标目录未找到。**
      * 如果运行程序时看到此警告，请确保包含图标文件的 `Icons` 文件夹与 `main.py` 文件位于同一目录。如果图标文件丢失，系统将使用默认的灰色占位符图标。
